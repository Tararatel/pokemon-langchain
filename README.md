# Система получения информации о покемонах

Этот проект представляет собой приложение на Node.js, которое собирает и обрабатывает информацию о покемонах, используя локальную базу данных, внешние API и инструменты веб-поиска. Приложение использует агент на основе LangChain для нормализации имен покемонов и получения данных из нескольких источников в приоритетном порядке.

## Возможности
- **Нормализация имен**: Исправляет опечатки и транслитерирует имена покемонов (например, "пикачу" → "pikachu") с помощью локальной модели LLaMA.
- **Получение данных из нескольких источников**:
  1. Запрашивает информацию о покемоне в локальной базе данных PostgreSQL.
  2. Если данные не найдены, обращается к [PokeAPI](https://pokeapi.co/).
  3. В случае неудачи использует [Tavily Search API](https://tavily.com/) для веб-поиска.
  4. Возвращает сообщение по умолчанию, если информация не найдена.
- **Граф на основе StateGraph**: Использует `StateGraph` от LangChain для управления процессом нормализации имен и получения данных.
- **Обработка ошибок**: Надежная обработка ошибок для сбоев API и некорректных входных данных.
- **Конфигурация окружения**: Использует `dotenv` для безопасного управления ключами API и другими конфиденциальными данными.

## Требования
- **Node.js**: Версия 18 или выше.
- **PostgreSQL**: Работающая база данных PostgreSQL для хранения информации о покемонах.
- **Ollama**: Локальная установка [Ollama](https://ollama.ai/) с моделью `llama3.1:8b` для нормализации имен.
- **Ключи API**:
  - Ключ [GigaChat API](https://gigachat.ai/).
  - Ключ [Tavily API](https://tavily.com/).
  - (Опционально) Ключ [LangSmith API](https://smith.langchain.com/) для трассировки.

## Установка
1. **Клонируйте репозиторий**:
   ```bash
   git clone https://github.com/your-username/pokemon-info-system.git
   cd pokemon-info-system
   ```

2. **Установите зависимости**:
   ```bash
   npm install
   ```

3. **Настройте файл окружения**:
   Создайте файл `.env` в корне проекта и добавьте следующие переменные:
   ```
   GIGACHAT_KEY=ваш_ключ_gigachat
   TAVILY_API_KEY=ваш_ключ_tavily
   LANGSMITH_API_KEY=ваш_ключ_langsmith
   LANGSMITH_TRACING=true
   LANGSMITH_ENDPOINT=https://api.smith.langchain.com
   LANGSMITH_PROJECT=PokemonGraph
   ```

4. **Настройте базу данных**:
   - Убедитесь, что PostgreSQL установлен и работает.
   - Настройте подключение к базе данных в файле `db/models/index.js`.
   - Выполните миграции для создания таблицы покемонов:
     ```bash
     npx sequelize-cli db:migrate
     ```

5. **Запустите Ollama**:
   - Установите [Ollama](https://ollama.ai/) и запустите модель `llama3.1:8b`:
     ```bash
     ollama run llama3.1:8b
     ```

## Использование
1. **Запустите приложение**:
   ```bash
   node index.js
   ```
   Приложение обработает список имен покемонов (например, `Pikachu`, `пикачу`, `питачу`, `Диглетт`) и выведет информацию о каждом из них в консоль.

2. **Пример вывода**:
   ```
   Запрашиваю информацию о покемоне: Pikachu
   Покемон pikachu: тип - electric, рост - 40 см, вес - 6 кг, источник: PokeAPI
   Запрашиваю информацию о покемоне: пикачу
   Покемон pikachu: тип - electric, рост - 40 см, вес - 6 кг, источник: PokeAPI
   Запрашиваю информацию о покемоне: Диглетт
   Покемон diglett: тип - ground, рост - 20 см, вес - 0.8 кг, источник: PokeAPI
   ```

## Структура проекта
- `index.js`: Точка входа, где выполняется основной цикл обработки имен покемонов.
- `agent/index.js`: Определяет граф LangChain для нормализации имен и получения данных.
- `tools/`:
  - `pokemonDbTool.js`: Инструмент для поиска в локальной базе данных.
  - `pokemonPokeApiTool.js`: Инструмент для запросов к PokeAPI.
  - `pokemonTavilyTool.js`: Инструмент для веб-поиска через Tavily.
  - `fallbackTool.js`: Инструмент для обработки случаев, когда данные не найдены.
- `db/models/index.js`: Конфигурация и модели Sequelize для работы с PostgreSQL.

## Алгоритм работы
1. **Нормализация имени**: Локальная модель `llama3.1:8b` исправляет опечатки и транслитерирует имена (например, "питачу" → "pikachu").
2. **Поиск данных**:
   - Проверяет локальную базу данных с помощью `pokemonDbTool`.
   - Если данные не найдены, обращается к `pokemonPokeApiTool` (PokeAPI).
   - Если API не возвращает данные, использует `pokemonTavilyTool` (Tavily Search).
   - Если ничего не найдено, возвращает сообщение через `fallbackTool`.
3. **Формат ответа**: `Покемон [имя]: [информация], источник: [источник]`.

## Конфигурация инструментов
- **pokemonDbTool**: Ищет в локальной базе данных PostgreSQL. Требуется таблица `Pokemons` с полями `name`, `type`, `height`, `weight`.
- **pokemonPokeApiTool**: Запрашивает данные через PokeAPI. Рост конвертируется из дециметров в сантиметры, вес — из гектограмм в килограммы.
- **pokemonTavilyTool**: Выполняет веб-поиск через Tavily, возвращая краткую информацию из результатов.
- **fallbackTool**: Возвращает сообщение об отсутствии информации.

## Требования к окружению
- Убедитесь, что все ключи API указаны в `.env`.
- Локальная модель Ollama должна быть доступна по адресу `http://localhost:11434`.
- PostgreSQL должен быть настроен и доступен.

## Возможные улучшения
- Добавить кэширование результатов для ускорения повторных запросов.
- Расширить базу данных для хранения дополнительной информации о покемонах.
- Добавить поддержку других языков для нормализации имен.
- Интегрировать дополнительные API для получения более полной информации.